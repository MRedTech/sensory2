<!DOCTYPE html>
<html>
<head>
  <title>SECURE ENTRY SYSTEM</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #e9f5e9;
      padding: 16px 3px 18px 3px;
      text-transform: uppercase;
    }
    h2 {
      color: #2b7a2b;
      text-align: center;
      margin-top: 5px;
      margin-bottom: 15px;
      font-size: 1.8em;
      letter-spacing: 1.5px;
    }
    .header-gradient {
      background: linear-gradient(135deg, #3bd97b 12%, #fff 64%, #2b7a2b 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 2em;
      font-weight: bold;
      margin-bottom: 2px;
      letter-spacing: 1.6px;
    }
    .main-tabs {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 0 auto 18px auto;
      max-width: 420px;
      z-index: 2;
    }
    .tab-btn {
      flex: 1 1 0;
      padding: 13px 6px;
      font-size: 22px;
      font-family: Arial,sans-serif;
      border: none;
      font-weight: 700;
      border-radius: 11px 11px 0 0;
      background: #f3fbf4;
      color: #176b39;
      letter-spacing: 2px;
      cursor: pointer;
      box-shadow: 0 3px 8px #cde9d5b9;
      transition: all 0.18s;
      border-bottom: 3px solid #e9f5e9;
    }
    .tab-btn.active {
      background: linear-gradient(145deg,#fff,#b7ffd7,#45f392,#176b39);
      color: #134d2a;
      border-bottom: 4px solid #3bd97b;
      box-shadow: 0 8px 28px #b4ffe6a9;
      z-index: 2;
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .db-section {
      background: #fff;
      border-radius: 13px;
      box-shadow: 0 2px 8px #176b3917;
      padding: 32px 14px 26px 14px;
      max-width: 430px;
      margin: 0 auto 24px auto;
      text-align: center;
    }
    .db-title {
      color: #146533;
      font-size: 1.36em;
      font-weight: bold;
      margin-bottom: 19px;
      letter-spacing: 1.2px;
    }
    .db-desc {
      color: #27864c;
      font-size: 15px;
      margin-bottom: 21px;
      font-family: Arial,sans-serif;
      letter-spacing: .5px;
    }
    .btn-3d, .db-btn {
      background: linear-gradient(145deg, #3bd97b 0%, #2b7a2b 100%);
      color: #fff;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: bold;
      padding: 13px 30px;
      box-shadow: 0 4px 16px 0 #bbdfbb, 0 1.5px 3px #3333;
      letter-spacing: 2px;
      cursor: pointer;
      margin-bottom: 5px;
      transition: box-shadow 0.18s, transform 0.1s;
    }
    .btn-3d:active, .db-btn:active {
      box-shadow: 0 2px 5px #bbb;
      transform: translateY(2px);
    }
    .footer {
      text-align: center;
      padding: 5px;
      font-size: 11px;
      color: #888888;
      margin-top: 30px;
      margin-bottom: 1px;
      font-family: Arial, sans-serif;
      font-weight: bold;
    }
    .clock-bar {
      max-width: 420px;
      margin: 0 auto 8px auto;
      background: linear-gradient(90deg,#3bd97b 15%,#2b7a2b 90%);
      border-radius: 18px;
      color: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      font-weight: bold;
      letter-spacing: 2px;
      padding: 7px 19px 6px 17px;
      box-shadow: 0 2px 7px #b7ffd75a;
    }
    /* Table database */
    #monthlyTable table {
      width: 100%; font-size: 13px; border-collapse: collapse; margin-top: 15px;
    }
    #monthlyTable th, #monthlyTable td {
      border: 1px solid #2b7a2b26; padding: 6px 6px;
      text-align: left;
    }
    #monthlyTable th {
      background: #e9f5e9; color: #176b39; font-weight: bold;
      font-size: 14px;
    }
    @media (max-width:500px){
      .main-tabs { max-width:98vw;}
      .db-section { max-width:99vw; padding:21px 2vw;}
      .tab-btn{ font-size:15.6px;}
      .clock-bar { max-width:98vw; padding:5px 2vw;}
    }
  </style>
  <!-- SweetAlert2 for popups -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
  <!-- TARIKH & MASA -->
  <div class="clock-bar">
    <span id="liveDateOnly"></span>
    <span id="liveTimeOnly"></span>
  </div>
  <div style="text-align:center;margin-bottom:8px;">
    <h2 class="header-gradient" style="margin-bottom:0.18em;">
      SECURE ENTRY
    </h2>
    <div style="color:#489167;font-size:15px;letter-spacing:0.7px;margin-bottom:7px;">
      REGISTER.ACCESS.SECURE
    </div>
    <div style="height:3px;width:60px;margin:0 auto 4px auto;background:linear-gradient(90deg,#3bd97b 20%,#2b7a2b 80%);border-radius:2px;"></div>
  </div>

  <!-- ==== TABS PILIHAN (Baru) ==== -->
  <div class="main-tabs">
    <button id="tabRegistration" class="tab-btn active" onclick="showTab('registration')">REGISTRATION</button>
    <button id="tabDatabase" class="tab-btn" onclick="showTab('database')">DATABASE</button>
  </div>

  <!-- ==== REGISTRATION FORM ==== -->
  <div id="registrationTab" class="tab-content active">
    <!-- [Letak semua borang pendaftaran sedia ada di sini!] -->
    <div style="text-align:center;margin-bottom:14px;color:#176b39;font-size:1.19em;">
      [BORANG PENDAFTARAN SEDIA ADA DI SINI]
    </div>
    <!-- ...sambung semua kod asal registration awak di sini... -->
  </div>

  <!-- ==== DATABASE SECTION ==== -->
  <div id="databaseTab" class="tab-content">
    <div class="db-section">
      <div class="db-title">DATABASE PREVIEW</div>
      <div style="margin-bottom:20px;">
        <label for="monthPicker" style="color:#146533;font-weight:700;">PILIH BULAN:</label>
        <input type="month" id="monthPicker" style="padding:8px 14px;border-radius:7px;font-size:16px;border:1.2px solid #2b7a2b;background:#e9f7ff;">
        <button onclick="loadMonthlyData()" class="btn-3d" style="margin-left:13px;">PREVIEW</button>
      </div>
      <div id="monthlyTable" style="overflow-x:auto;max-width:99vw;"></div>
      <button onclick="downloadMonthlyCSV()" class="btn-3d" style="margin-top:14px;display:none;" id="downloadMonthlyBtn">DOWNLOAD CSV</button>
      <button onclick="printMonthlyTable()" class="btn-3d" style="margin-top:8px;display:none;" id="printMonthlyBtn">PRINT PDF</button>
    </div>
  </div>

  <div class="footer">POWERED BY MRED TECH</div>

  <script>
    // TARIKH & MASA LIVE
    function pad(n){return n<10?'0'+n:n}
    function updateDateTime() {
      const now = new Date();
      const d = pad(now.getDate());
      const m = pad(now.getMonth() + 1);
      const y = now.getFullYear();
      const h = pad(now.getHours());
      const min = pad(now.getMinutes());
      const s = pad(now.getSeconds());
      document.getElementById("liveDateOnly").textContent = `${d}/${m}/${y}`;
      document.getElementById("liveTimeOnly").textContent = `${h}:${min}:${s}`;
    }
    setInterval(updateDateTime, 1000);
    updateDateTime();

    // TAB SWITCHER
    function showTab(tab) {
      document.getElementById('tabRegistration').classList.toggle('active', tab==='registration');
      document.getElementById('tabDatabase').classList.toggle('active', tab==='database');
      document.getElementById('registrationTab').style.display = tab==='registration' ? '' : 'none';
      document.getElementById('databaseTab').style.display = tab==='database' ? '' : 'none';
      document.getElementById('tabRegistration').classList.toggle('active', tab==='registration');
      document.getElementById('tabDatabase').classList.toggle('active', tab==='database');
    }

    // DATABASE PREVIEW FUNGSI (AJAX ke backend)
    const WORKER_URL = "https://ext-gs12.edreborn86.workers.dev"; // <-- Tukar ke endpoint anda jika lain

    async function loadMonthlyData() {
      const month = document.getElementById('monthPicker').value;
      if (!month) return Swal.fire('Pilih bulan dahulu!', '', 'warning');
      document.getElementById('monthlyTable').innerHTML = `<div style="color:#176b39;font-size:17px;font-weight:bold;margin-top:14px;">
        <span class="spinner"></span> Loading data...</div>`;
      document.getElementById('downloadMonthlyBtn').style.display = 'none';
      document.getElementById('printMonthlyBtn').style.display = 'none';

      try {
        const res = await fetch(`${WORKER_URL}?month=${month}`);
        const json = await res.json();
        if (!json.success || !json.data || !json.data.length) {
          document.getElementById('monthlyTable').innerHTML = "<div style='color:#888;margin-top:22px;'>Tiada data untuk bulan ini.</div>";
          return;
        }
        // Build HTML table
        let html = "<table><tr>";
        html += "<th>TARIKH</th><th>NAMA</th><th>MYKAD</th><th>REGNUM</th><th>CONTACT</th><th>CATEGORY</th><th>TOWER</th></tr>";
        for (let row of json.data) {
          html += `<tr>
            <td>${row[0]}</td>
            <td>${row[1]}</td>
            <td>${row[2]}</td>
            <td>${row[3]}</td>
            <td>${row[4]}</td>
            <td>${row[5]}</td>
            <td>${row[6]}</td>
          </tr>`;
        }
        html += "</table>";
        document.getElementById('monthlyTable').innerHTML = html;
        document.getElementById('downloadMonthlyBtn').style.display = 'inline-block';
        document.getElementById('printMonthlyBtn').style.display = 'inline-block';
        window._lastMonthlyData = json.data; // Simpan untuk export CSV
      } catch (e) {
        document.getElementById('monthlyTable').innerHTML = "<div style='color:red'>Gagal dapat data bulan ini.</div>";
      }
    }

    function downloadMonthlyCSV() {
      if (!window._lastMonthlyData || !window._lastMonthlyData.length) return;
      let rows = window._lastMonthlyData;
      let csv = "TARIKH,NAMA,MYKAD,REGNUM,CONTACT,CATEGORY,TOWER\n";
      for (let row of rows) {
        csv += row.map(x => `"${x}"`).join(",") + "\n";
      }
      let blob = new Blob([csv], { type: 'text/csv' });
      let a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `secureentry_${document.getElementById('monthPicker').value}.csv`;
      a.click();
    }

    function printMonthlyTable() {
      let divContents = document.getElementById("monthlyTable").innerHTML;
      let a = window.open('', '', 'height=600, width=900');
      a.document.write('<html><head><title>Secure Entry Monthly Record</title>');
      a.document.write('<style>table{width:100%;font-size:14px;border-collapse:collapse;} th,td{border:1px solid #2b7a2b;padding:6px;} th{background:#e9f5e9;color:#176b39;}</style>');
      a.document.write('</head><body>');
      a.document.write('<h2 style="color:#146533;">Monthly Record - Secure Entry</h2>');
      a.document.write(divContents);
      a.document.write('</body></html>');
      a.document.close();
      a.print();
    }
  </script>
</body>
</html>
